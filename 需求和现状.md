> 既当甲方又当乙方是什么感觉？

预先说明：这既是为了完成个人的需求，也是为了学习各种技术和框架，因此尽量去使用各种框架而非自己实现，尽量使用文档的最佳实践而非整自己的野路子。

# 需求

在这个 App 上我想实现的功能有一箩筐，显然得先去把需求明确一下，先专注最重要，最核心的功能，再专注其它的。

于是，首先需要知道我的需求——让我的生活过的更有计划性，能明确每时每刻的目标。

我一直在使用《Todo 清单》这个 App，它很大程度上能够满足需求，但也有很多缺陷：

1. 同步功能很残疾，总是出篓子（主要是这点让我放弃它）
2. 没法定义一段日期的任务（考虑到定义周任务，月任务是我的一个挺想要的需求）
3. 没法登记任务进度等（只能通过编辑描述来间接地如此）

为此，我希望自己实现一个 Todo 清单，它**最首先**需要有这样的特性：

1. 强一致性的同步——本地不维护任何数据，完全从服务器中来，到服务器中去（这要求无法并发修改，但 tmd 哪有谁同时用两个终端去做修改的？）
2. 能定义段日期的任务，这样的任务将在这段日期中任何时候都可见（但其优先级低于当前任务）
   - 自然周，自然月应当是段日期的“字典项”，也可以显式指定段日期的起始时间和终止时间
3. 能查看当前，过去以及未来某日的合法的 task，其要按照优先级去降序展示，段日期的 task 段长度越大优先级越低
4. 能完成，登记进度，删除特定 TODO
5. 多用户

为了尽量方便，使用 todo.txt 的语法去表示 task，其中各部分以及 description 中各部分需要被 token 化，以在之后的格式化等需求中利用。

前端暂且使用 CLI，考虑用 nodejs 去写，以使其能方便地跨平台（毕竟 nodejs 挺好装的，代码分发也容易）。

其次，还需要有如下特性：

1. 能够按上下文，项目，优先级去筛选 task
2. 能够定义重复的任务
3. ……

# 第一阶段目标

1. [X] 实现 Task 解析器，将 todo.txt 的语法的字符串解析成 Task 对象，分离出项目，上下文和 kv tag，优先级，时间等
   - 从一开始就去妥善处理 kv tag，专门为其做抽象，比如去为每个 kv tag 去定义相关 Handler
2. [X] 实现 Task 的最简单的增删改查（该整点 mybatis 了！）
3. [X] 使用 Shiro，实现一个简单的权限系统用以区分用户，并且防止用户访问非自己的 Task（这样的话如何方便测试和 debug 需要研究一下）
4. [X] 使用控制台实现一个最简单的"前端"，实现**查看当前**（按优先级），添加，删除，完成，编辑 Task 的功能
   - 用 Nodejs，进行适当抽象以供之后切换到 React 时重用
   - 这属于业务层上的建模，要能够重用还挺方便的

# 第二阶段

1. [X] 实现注册接口，通过邮箱进行校验（密码直接发送到邮箱，且这个注册接口需要使用图形验证码去限制），且限制用户调用注册接口的频率
   - 按常理来说使用邮箱的话其它敏感操作比如更改密码，找回密码也应当需要邮箱验证码…但有这个必要吗？
   - 可以在忘记密码时直接使用注册时的逻辑，自动生成密码并发送到邮箱
   - 登陆时也应当允许使用邮箱去登陆
2. [ ] 使用 React 去实现前端
   - 响应式布局，因为之后还想作为 PWA 在手机上用
   - 深入学习 React，尽量使用 react 的各种最佳实践
3. [ ] 研究使用JWT来进行认证，避免Cookie的SameSite问题
4. [ ] Task 编辑功能（好实现，但用户友好的？不是那么方便的）
5. [ ] 实现 repeat 的 Task，模仿 TodoList 的形式
6. [ ] 使 Task 能添加富文本内容，包括但不限于图片，文件，音频，段文本（后端仍旧是纯字符串形式，通过 KV Tag 通过哈希来引用，由前端渲染）
   1. 其中前端需要尽可能方便地提供相应功能，如通过剪切板插入图片，点击按钮播放音频等
   2. 段文本不提供嵌套功能
7. [X] 实现查看任一日的合法 Task

# 第三阶段

1. 一般化Task的筛选接口，提供前端更强大的筛选task的能力
2. 使用swagger，为所有接口编写文档以方便第三方客户端
3. 通过缓存来优化性能，减少请求数据库的次数
4. 实现 Task 统计功能
   - 考虑到数据量不会大到"大数据"到程度，直接使用数据库就行
   - 还得研究下怎么整，预备尝试一下定时任务，考虑用quartz？
5. 自定义 Task 的显示（比如把各种 tag 转成真正的标签等形式，并提供更多样式），让前端更性感
6. React做好i18n

# ???

It sounds Crazy...

1. 记录设计与实现的全部思路，先立大纲，再写英文稿，最后再写中文稿
2. 上 React Native
